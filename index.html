<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zapwaterson</title>
    
    <style>

        
        body{
    margin: 0;
    overflow: hidden;
    background-image: url(https://img.freepik.com/premium-photo/lot-3d-whatsapp-green-glossy-pills-close-up-view_284880-36.jpg?semt=ais_hybrid&w=740&q=80);
    background-size: cover;
    font-family:Arial, Helvetica, sans-serif ;
    
}


#Canvas{
    display: block;
    background-image: url(https://storage.ko-fi.com/cdn/useruploads/display/e86c13b0-4e16-4c56-b5b5-1a90acbea77c_naruwhatsappwallpaperdark.png);
    margin: 0 auto;
    
}
#pontuacao{
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 24px;
    color: #fff;
}
#menu{
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #fff;
    font-size: 24px;
}

#menu-button{
    padding: 10px 20px;
    font-size: 20px;
    margin: 10px;
    cursor: pointer;
}

    </style>
</head>
<body>
<canvas id="Canvas">Seu pc é de pobre e não suporta html5</canvas>

<div id="menu">
    <h1>Corrida du zapi zapi</h1>
            <label for="dificuldade">Dificuldade: </label>
        <select id="dificuldade">
            <option value="facil">Fácil</option>
            <option value="medio" selected>Médio</option>
            <option value="dificil">Difícil</option>
            <option value="impossible">Impossívio</option>
        </select>
        <h1></h1>
    <button id="menu-button" onclick="iniciarJogo()">Start</button>
</div>
    


<script>   
const canvas = document.getElementById("Canvas");
const ctx = canvas.getContext("2d");
const car = new Image();
car.src = 'src/zap.webp'
const obs = new Image();
obs.src = 'src/dc.jpg'

 const muska = new Audio('snd/remix.m4a');
    muska.volume = 0.05;
    muska.loop = true;
const derrota = new Audio('snd/dc.mp3');
    derrota.volume = 1;
    derrota.loop = false;

    function carregarMusicas() {
        muska.currentTime = 0;
        muska.play();
    }

    function pararMusica() {
        muska.pause();
        muska.currentTime = 0;
    }

    function somDerrota() {
        derrota.currentTime = 0;
        derrota.play();
    }

let jogoAtivo = false;
let velocidadeObstaculos = 5;
let pontuacao = 0;
let carro, obstaculos, intervaloObstaculos, teclado;
let pontosAumentarVelocidade = 20;
let animacaoId;

canvas.width = 480;
canvas.height = 600;

function reiniciarJogo() {
    jogoAtivo = false;
    pontuacao = 0;
    let velocidadeObstaculos;
    let intervaloObstaculos;
    obstaculos = [];
    teclado = {};
    document.getElementById("menu").style.display = 'block';
    cancelarAnimacao();
}

function iniciarJogo() {
    jogoAtivo = true;
    document.getElementById('menu').style.display = 'none'; 
    carro = {
        x: canvas.width / 2 - 25,
        y: canvas.height - 120,
        largura: 70,
        altura: 70,
        velocidade: 5,
        cor: "#00f"
    };
    obstaculos = [];
    pontuacao = 0;
    teclado = {};
    carregarMusicas();
    atualizarJogo();
        let dificuldade = document.getElementById("dificuldade").value;

        switch (dificuldade) {
            case "facil":
                 velocidadeObstaculos = 5;
                 intervaloObstaculos = 100;
                 break;
            case "medio": 
            velocidadeObstaculos = 10;
            intervaloObstaculos = 100;
             break;
            case "dificil": 
            velocidadeObstaculos = 15;
            intervaloObstaculos = 100;
            break;
            case "impossible": 
            velocidadeObstaculos = 75;
            intervaloObstaculos = 100;
             break;
        }

}

function desenharCarro() {
    ctx.drawImage(car,carro.x, carro.y, carro.largura, carro.altura);
}

function moverCarro() {
    if (teclado["ArrowLeft"] && carro.x > 0) {
        carro.x -= carro.velocidade;
    }
    if (teclado["ArrowRight"] && carro.x < canvas.width - carro.largura) {
        carro.x += carro.velocidade;
    }
    if (teclado["A"] || teclado["a"] && carro.x > 0) {
        carro.x -= carro.velocidade;
    }
    if (teclado["D"] || teclado["d"] && carro.x < canvas.width - carro.largura) {
        carro.x += carro.velocidade;
    }
}

function gerarObstaculos() {
    let larguraObstaculo = Math.random() * (canvas.width / 2) + 30;
    let xPosicaoObstaculo = Math.random() * (canvas.width - larguraObstaculo);
    obstaculos.push({ x: xPosicaoObstaculo, y: -100, largura: larguraObstaculo, altura: 30 });
}

function desenharObs() {
    
    obstaculos.forEach(obstaculo => { 
        ctx.drawImage(obs,obstaculo.x, obstaculo.y, obstaculo.largura, obstaculo.altura);
    });
}

function moverObs() {
    obstaculos.forEach((obstaculo, index) => {
        obstaculo.y += velocidadeObstaculos;
        if (obstaculo.y > canvas.height) {
            obstaculos.splice(index, 1);
            pontuacao += 10;
        }
    });
}

function detectarColisao() {
    for (let obstaculo of obstaculos) {
        if (
            carro.x < obstaculo.x + obstaculo.largura &&
            carro.x + carro.largura > obstaculo.x &&
            carro.y < obstaculo.y + obstaculo.altura &&
            carro.y + carro.altura > obstaculo.y
        ) {
            pararMusica();
            somDerrota();
            alert('fiu fiu fiu fiu fiu');  
            reiniciarJogo();
        }
    }
}

function atualizarPontos() {
    ctx.fillStyle = '#fff';
    ctx.font = "24px Arial";
    ctx.fillText("Pontuação: " + pontuacao, 10, 30);
}

function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }


function atualizarJogo() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    desenharCarro();
    moverCarro();
    desenharObs();
    moverObs();
    detectarColisao();
    atualizarPontos();

    if (intervaloObstaculos % 100 === 0) {
        gerarObstaculos();
    }

    intervaloObstaculos++;

    if (pontuacao >= pontosAumentarVelocidade) {
        velocidadeObstaculos += 0.5;
        pontosAumentarVelocidade += 20;
    }

    if (jogoAtivo) {
        animacaoId = requestAnimationFrame(atualizarJogo); 
    }
}

window.addEventListener("keydown", (event) => {
    teclado[event.key] = true;
});

window.addEventListener("keyup", (event) => {
    teclado[event.key] = false;
});

function cancelarAnimacao() {
    cancelAnimationFrame(animacaoId);
}

reiniciarJogo();
</script>
</body>

</html>
